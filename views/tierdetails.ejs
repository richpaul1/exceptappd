<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
<link rel="stylesheet" href="/css/spinner.css" type="text/css">
<style>


#container
{
width: 90%;
height: 700px;
margin: 10px auto;
background-color: #fff;
color: #333;
border: 1px solid gray;
line-height: 130%;
}

#graph
{
float: left;
width: 550px;
height: 700px;
border-right: 1px solid gray;
}

#errors
{
margin-left: 550px;
padding: 1em;
max-width: 36em;
}


#graph p { margin: 0 0 1em 0; }
#errors h2 { margin: 0 0 .5em 0; }


table {
	font-family:Arial, Helvetica, sans-serif;
	font-size:12px;
	margin:10px;
	border:black 1px solid;
}
table th {
}
table th:first-child {
	text-align: left;
	padding-left:20px;
}
table td {
}
table tr.even td {
}
</style>
<script src= "http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.min.js"></script>

<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-46742907-3', 'auto');
ga('send', 'pageview');

</script>
</head>
<body>
<div id="container">
	<div id="graph">
		<img src="/public/images/<%=appid%>_<%=tierid%>.png"/>
	</div>
	<div id="errors" class="datagrid" ng-app="" ng-controller="errorController">
		<p>  Fetching exceptions that are above their averages.</p>
		<table class="pure-table">
			<thead>
				<tr>
			  		<th>Exception</th>
					<th><%=week%> Week Avg</th>
			  		<th><%=lastminutes%> Minute Avg</th>
			  		<th>Difference</th>
				</tr>
			</thead>
			<tbody>
				<tr ng-repeat="err in exceptions" ng-class-odd="'alt'">
				    <td><a href="{{err.url}}">{{err.name}}</a></td>
				    <td>{{err.weekavg}}</td>
				    <td>{{err.minavg }}</td>
				    <td>{{err.diff }}</td>
				</tr>
			</tbody>
		</table>
		<div id="waitmessage"><p>Please wait, this can take about 1 minute.</p> <div id="spinner" class="throbber">	Loading...</div></div>
		
	</div>
</div>
<script>
function errorController($scope,$http) {
  $http.get("/exceptionstatsjson/<%=appid%>/<%=tierid%>")
  .success(function(response) {
  		document.getElementById("waitmessage").style.display = 'none';
  		$scope.exceptions = response;
  	});
}
</script>

</body>
</html>
